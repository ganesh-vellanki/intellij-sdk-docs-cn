


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Implementing Lexer / IntelliJ Platform SDK  DevGuide</title>
    <link rel="stylesheet" href="/app/app.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="mask-icon" href="/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://intellij-sdk-docs-cn.github.io//reference_guide/custom_language_support/implementing_lexer.html" />
    <meta property="og:site_name" content="JetBrains IntelliJ Platform SDK" />
    <meta property="og:title" content="Implementing Lexer" />
    <meta property="og:description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta property="og:image" content="https://intellij-sdk-docs-cn.github.io/jetbrains.png" />
    <meta property="article:modified_time" content="2020-02-19T22:25:03+08:00" />
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JBPlatform" />
    <meta name="twitter:title" content="Implementing Lexer" />
    <meta name="twitter:description" content="Documentation for working with and extending the IntelliJ Platform SDK" />
    <meta name="twitter:image" content="https://intellij-sdk-docs-cn.github.io/jetbrains.png" />
    <meta class="swiftype" name="product" data-type="string" content="/"></meta>
<link  rel="stylesheet" href="/app/styles.css"></head>
<body data-id="reference_guide/custom_language_support/implementing_lexer">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search IntelliJ Platform SDK  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a data-bypass="true" href="//youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2020 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>IntelliJ Platform SDK DevGuide</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/reference_guide/custom_language_support/registering_file_type.html">Registering a File Type</a>
                        <a class="navigation-links__next" href="/reference_guide/custom_language_support/implementing_parser_and_psi.html">Implementing a Parser and PSI</a>
                    </div>
                    <a data-bypass="true" href="https://github.com/intellij-sdk-docs-cn/intellij-sdk-docs-cn/edit/master/reference_guide/custom_language_support/implementing_lexer.md" class="page-link-to-github" target="_blank" title="Edit this page on GitHub">
                        <i class="github-icon"></i>
                        <span class="text">Edit page</span>
                    </a>

                    <h1>Implementing Lexer</h1>
                    <!-- Copyright 2000-2020 JetBrains s.r.o. and other contributors. Use of this source code is governed by the Apache 2.0 license that can be found in the LICENSE file. -->

<p>The lexer, or
<a href="https://en.wikipedia.org/wiki/Lexical_analysis" data-bypass="yes" target="_blank"><span>lexical analyzer</span></a>,
defines how the contents of a file is broken into tokens.
The lexer serves as a foundation for nearly all of the features of custom language plugins, from basic syntax highlighting to advanced code analysis features.
The API for the lexer is defined by the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/Lexer.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">Lexer</code></span></a> interface.</p>

<p>The IDE invokes the lexer in three main contexts, and the plugin can provide different lexer implementations for these contexts:</p>

<ul>
  <li>
    <p>Syntax highlighting: The lexer is returned from the implementation of the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/editor-ui-api/src/com/intellij/openapi/fileTypes/SyntaxHighlighterFactory.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">SyntaxHighlighterFactory</code></span></a>
interface which is registered in the <code class="code highlight language-text">com.intellij.lang.syntaxHighlighterFactory</code> extension point.</p>
  </li>
  <li>
    <p>Building the syntax tree of a file: the lexer is expected to be returned from
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lang/ParserDefinition.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">ParserDefinition.createLexer()</code></span></a>,
and the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lang/ParserDefinition.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">ParserDefinition</code></span></a>
interface is registered in the <code class="code highlight language-text">com.intellij.lang.parserDefinition</code> extension point.</p>
  </li>
  <li>
    <p>Building the index of the words contained in the file:
if the lexer-based words scanner implementation is used, the lexer is passed to the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/indexing-api/src/com/intellij/lang/cacheBuilder/DefaultWordsScanner.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">DefaultWordsScanner</code></span></a>
constructor.</p>
  </li>
</ul>

<p>The lexer used for syntax highlighting can be invoked incrementally to process only the changed part of a file, whereas lexers used in other contexts are always called to process an entire file, or a complete language construction embedded in a file in a different language.</p>

<p>A lexer that can be used incrementally may need to return its <em>state</em>, which means the context corresponding to each position in a file.
For example, a
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/java/java-psi-impl/src/com/intellij/lang/java/lexer/JavaLexer.java" data-bypass="yes" target="_blank"><span>Java lexer</span></a>
could have separate states for top level context, comment context and string literal context.
An important requirement for a syntax highlighting lexer is that its state must be represented by a single integer number returned from
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/Lexer.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">Lexer.getState()</code></span></a>.
That state will be passed to the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/Lexer.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">Lexer.start()</code></span></a>
method, along with the start offset of the fragment to process, when lexing is resumed from the middle of a file.
Lexers used in other contexts can always return <code class="code highlight language-text">0</code> from the <code class="code highlight language-text">getState()</code> method.</p>

<p>The easiest way to create a lexer for a custom language plugin is to use <a href="https://jflex.de" data-bypass="yes" target="_blank"><span>JFlex</span></a>.
Classes
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/FlexLexer.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">FlexLexer</code></span></a>
and
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/FlexAdapter.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">FlexAdapter</code></span></a>
adapt JFlex lexers to the IntelliJ Platform Lexer API.
We have a
<a href="https://github.com/JetBrains/intellij-deps-jflex" data-bypass="yes" target="_blank"><span>patched version of JFlex</span></a>
that can be used with the lexer skeleton file located at <em>tools/lexer/idea-flex.skeleton</em> in the
<a href="https://github.com/JetBrains/intellij-community" data-bypass="yes" target="_blank"><span>IntelliJ IDEA Community Edition</span></a>
source to create lexers compatible with
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/lexer/FlexAdapter.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">FlexAdapter</code></span></a>.
The patched version of JFlex provides a new command line option <code class="code highlight language-text">--charat</code> which changes the JFlex generated code so that it works with the IntelliJ Platform skeleton.
Enabling <code class="code highlight language-text">--charat</code> option passes the source data for lexing as a
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">CharSequence</code></span></a>
and not as an array of characters.</p>

<p>For developing lexers using JFlex, the <a href="https://plugins.jetbrains.com/plugin/6606-grammar-kit" data-bypass="yes" target="_blank"><span>GrammarKit plugin</span></a> can be useful.
It provides syntax highlighting and other useful features for editing JFlex files.</p>

<aside class="note">
  <p> Lexers, and in particular JFlex-based lexers, need to be created in such a way that they always match the entire contents of the file, without any gaps between tokens, and generate special tokens for characters which are not valid at their location.
Lexers must never abort prematurely because of an invalid character.</p>
</aside>

<p><strong>Example</strong>:</p>
<ul>
  <li><a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/plugins/properties/src/com/intellij/lang/properties/parsing/Properties.flex" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">Lexer</code></span></a>
definition for
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/plugins/properties" data-bypass="yes" target="_blank"><span>Properties language plugin</span></a></li>
  <li><a href="/tutorials/custom_language_support/lexer_and_parser_definition.html"><span>Custom Language Support Tutorial: Lexer</span></a></li>
</ul>

<p>Types of tokens for lexers are defined by instances of
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/tree/IElementType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">IElementType</code></span></a>.
A number of token types common for all languages are defined in the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/TokenType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">TokenType</code></span></a>
interface.
Custom language plugins should reuse these token types wherever applicable.
For all other token types, the plugin needs to create new
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/tree/IElementType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">IElementType</code></span></a>
instances and associate with the language in which the token type is used.
The same
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/tree/IElementType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">IElementType</code></span></a>
instance should be returned every time a particular token type is encountered by the lexer.</p>

<p><strong>Example:</strong>
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/plugins/properties/properties-psi-api/src/com/intellij/lang/properties/parsing/PropertiesTokenTypes.java" data-bypass="yes" target="_blank"><span>Token types</span></a>
for
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/plugins/properties" data-bypass="yes" target="_blank"><span>Properties language plugin</span></a></p>

<p>An important feature which can be implemented at lexer level is mixing languages within a file, for example, embedding fragments of Java code in some template language.
If a language supports embedding its fragments in another language, it needs to define the chameleon token types for different types of fragments which can be embedded, and these token types need to implement the
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/tree/ILazyParseableElementType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">ILazyParseableElementType</code></span></a>
interface.
The lexer of the enclosing language needs to return the entire fragment of the embedded language as a single chameleon token, of the type defined by the embedded language.
To parse the contents of the chameleon token, the IDE will call the parser of the embedded language through a call to
<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-e2d423f42b53eafd5c625b93149a0ebc7e49756c/platform/core-api/src/com/intellij/psi/tree/ILazyParseableElementType.java" data-bypass="yes" target="_blank"><span><code class="code highlight language-text">ILazyParseableElementType.parseContents()</code></span></a>.</p>


                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/reference_guide/custom_language_support/registering_file_type.html">Registering a File Type</a>
                        <a class="navigation-links__next" href="/reference_guide/custom_language_support/implementing_parser_and_psi.html">Implementing a Parser and PSI</a>
                    </div>
                    <div class="last-modified">
                        Last modified: 19 February 2020
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/app/app.js" data-baseurl="/"></script>

</body>
</html>

